<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ViajesMX - Reservaciones Movil</title>
    <!-- link de css Boostrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <!-- Link css Propio -->
    <link rel="stylesheet" href="../assets/css/styles-movil-app.css">
</head>

<body>

    <!-- SVG -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="search" viewbox="0 0 16 16">
            <path
                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
        </symbol>

        <symbol id="home" viewbox="0 0 16 16">
            <path
                d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z" />
        </symbol>

        <symbol id="home-active" viewbox="0 0 16 16">
            <path
                d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5Z" />
            <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6Z" />
        </symbol>

        <symbol id="calendar" viewbox="0 0 16 16">
            <path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z" />
            <path
                d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
        </symbol>

        <symbol id="calendar-active" viewbox="0 0 16 16">
            <path
                d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4V.5zM16 14V5H0v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2zm-3.5-7h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5z" />
        </symbol>

        <symbol id="contact" viewbox="0 0 16 16">
            <path
                d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
            <path
                d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z" />
        </symbol>

        <symbol id="contact-active" viewbox="0 0 16 16">
            <path
                d="M16 8c0 3.866-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.584.296-1.925.864-4.181 1.234-.2.032-.352-.176-.273-.362.354-.836.674-1.95.77-2.966C.744 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7zM5 8a1 1 0 1 0-2 0 1 1 0 0 0 2 0zm4 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
        </symbol>

        <symbol id="return" viewbox="0 0 16 16">
            <path
                d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z" />
        </symbol>
    </svg>

    <div class="contenedor-principal-mx">

        <div class="header-search-app-details">
            <h3 style="color: rgb(196, 196, 196); margin-top: 10px;">Mis viajes</h3>
        </div>

        <div class="container-serach-app">
            <h4>Viajes en proceso</h4>
            <div id="first1"> </div>
            <h4>Viajes realizados</h4>
            <div id="second2"> </div>
        </div>

        <nav class="fixed-bottom" id="nav-bottom">
            <center>
                <div id="icons-container">

                    <a href="../movile-version/home-movile-view.html">
                        <svg class="bi" width="30" height="30" style="fill: #046cdcae; margin-top: -20px;">
                            <use xlink:href="#home" />
                        </svg>
                    </a>

                    <a href="../movile-version/reservations-movil-view.html">
                        <svg class="bi" width="30" height="30" style="fill: #046cdcae; margin-top: -20px;">
                            <use xlink:href="#calendar-active" />
                        </svg>
                    </a>

                    <a href="../movile-version/contact-movile-view.html">
                        <svg class="bi" width="30" height="30" style="fill: #046cdcae; margin-top: -20px;">
                            <use xlink:href="#contact" />
                        </svg>
                    </a>

                </div>
            </center>
        </nav>
    </div>


    <!-- Scripts de Boostrap -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
        integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
        crossorigin="anonymous"></script>

    <!-- Script des sweetalert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Script de Firebase -->
    <script type="module">
        // Importar Firebase y Firestore
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
        import { getFirestore, enableIndexedDbPersistence, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDt4o-uvGTqqwABAcNW8opH4iyA82B0blE",
            authDomain: "viajesmx-f07c8.firebaseapp.com",
            projectId: "viajesmx-f07c8",
            storageBucket: "viajesmx-f07c8.appspot.com",
            messagingSenderId: "437734415626",
            appId: "1:437734415626:web:821aaf367d26a5974aeef3"
        };

        // Inicialización de Firebase y Firestore con persistencia habilitada
        const app = initializeApp(firebaseConfig);
        const firestore = getFirestore(app);

        // Habilitar persistencia
        enableIndexedDbPersistence(firestore)
            .then(() => {
                console.log("Persistencia de Firestore activada");
            })
            .catch((err) => {
                if (err.code === 'failed-precondition') {
                    // Multiple tabs open, persistence can only be enabled
                    // in one tab at a a time.
                    console.error('Multiple tabs open, persistence can only be enabled in one tab at a time.');
                } else if (err.code === 'unimplemented') {
                    // The current browser does not support all of the
                    // features required to enable persistence
                    console.error('The current browser does not support all of the features required to enable persistence.');
                }
            });


        const collectionRef = collection(firestore, "reservaciones");

        //SCRIPT PROPIO******
        //dom's
        const seccion1 = document.getElementById("first1");
        const seccion2 = document.getElementById("second2");

        //Funcion para crear las tarjetas de los viajes en curso
        function crearTarjetaVC(imagen, nombre, ubicacion) {
            // Contenedor / link tarejta
            const link = document.createElement("a");

            //Contenedor2
            const tarjeta = document.createElement("div");
            tarjeta.classList.add("card1");
            tarjeta.id = "idmargen-imagen";
            tarjeta.style = "margin-top: 20px;"

            //imagen
            const imagen1 = document.createElement("img");
            imagen1.src = "../assets/images/places/" + imagen;
            imagen1.alt = nombre;

            const wrapper = document.createElement("div");
            wrapper.style = "margin-left: 15px;";

            //Titulo
            const titulo = document.createElement("p");
            titulo.setAttribute("style", "font-weight: bold; font-size: 20px; margin-top: 10px;");
            titulo.textContent = nombre;
            //Subtitulo
            const titulo1 = document.createElement("p");
            titulo1.setAttribute("style", "font-weight: bold; font-size: 20px; margin-top: 10px;");
            titulo1.textContent = ubicacion;

            //Seccion de botones (wrapper)
            const botones = document.createElement("div");
            botones.classList.add("btns-informations");
            //Hijos de la seccion de botones
            const contactar = document.createElement("a");
            contactar.id = "btnContactar";
            contactar.textContent = "Contactar";
            contactar.addEventListener("click", () => {
                Swal.fire({
                    icon: "info",
                    title: "Contactar",
                    text: "Para darte una mayor atencion llama a este numero: 6678241087.",
                });
            });

            const reportar = document.createElement("a");
            contactar.id = "btnReportar";
            contactar.textContent = "Reportar";
            contactar.addEventListener("click", () => {
                Swal.fire({
                    icon: "error",
                    title: "Reportar",
                    text: "Lamentamos que sea asi, llama a este numero: 9035275139 para realizar el reporte.",
                });
            });


            //Adjuncion de los elementos
            link.appendChild(tarjeta);
            tarjeta.appendChild(imagen1);
            tarjeta.appendChild(wrapper);
            wrapper.appendChild(titulo);
            wrapper.appendChild(titulo1);
            wrapper.appendChild(botones);
            botones.appendChild(contactar);
            botones.appendChild(reportar);

            return link;
        }


        //Funcion para crear las tarejtas de los viajes concluidos
        function crearTarjetaC(imagen, nombre, ubicacion) {
            // Contenedor / link tarejta
            const link = document.createElement("a");

            //Contenedor2
            const tarjeta = document.createElement("div");
            tarjeta.classList.add("card1");
            tarjeta.id = "idmargen-imagen";
            tarjeta.style = "margin-top: 20px;"

            //imagen
            const imagen1 = document.createElement("img");
            imagen1.src = "../assets/images/places/" + imagen;
            imagen1.alt = nombre;

            const wrapper = document.createElement("div");
            wrapper.style = "margin-left: 15px;";

            //Titulo
            const titulo = document.createElement("p");
            titulo.setAttribute("style", "font-weight: bold; font-size: 20px; margin-top: 10px;");
            titulo.textContent = nombre;
            //Subtitulo
            const titulo1 = document.createElement("p");
            titulo1.setAttribute("style", "font-weight: bold; font-size: 20px; margin-top: 10px;");
            titulo1.textContent = ubicacion;

            //Seccion de botones (wrapper)
            const botones = document.createElement("div");
            botones.classList.add("btns-informations");
            //Hijos de la seccion de botones
            const contactar = document.createElement("a");
            contactar.id = "btnContactar";
            contactar.textContent = "Me gusto";
            contactar.addEventListener("click", () => {
                Swal.fire({
                    icon: "info",
                    title: "Contactar",
                    text: "Para darte una mayor atencion llama a este numero: 6678241087.",
                });
            });

            //Adjuncion de los elementos
            link.appendChild(tarjeta);
            tarjeta.appendChild(imagen1);
            tarjeta.appendChild(wrapper);
            wrapper.appendChild(titulo);
            wrapper.appendChild(titulo1);
            wrapper.appendChild(botones);
            botones.appendChild(contactar);

            return link;
        }

        // Funciones para mostrar viajes (actualizado para manejar datos offline)
        function viajesCurso(usuario) {
            const query1 = query(collectionRef, where("idusuario", "==", usuario), where("estadoviaje", "==", "pendiente"));
            getDocs(query1)
                .then((querySnapshot) => {
                    querySnapshot.forEach((doc1) => {
                        const data1 = doc1.data();
                        const tarjeta = crearTarjetaVC(data1.imagen, data1.nombre, data1.ubicacion);
                        seccion1.appendChild(tarjeta);
                    });
                }).catch((err) => {
                    console.error('Error al realizar la consulta: ' + err);
                });
        }

        function viajesConcluidos(usuario) {
            const query2 = query(collectionRef, where("idusuario", "==", usuario), where("estadoviaje", "==", "completado"));
            getDocs(query2)
                .then((querySnapshot) => {
                    querySnapshot.forEach((doc2) => {
                        const data2 = doc2.data();
                        const tarjeta1 = crearTarjetaC(data2.imagen, data2.nombre, data2.ubicacion);
                        seccion2.appendChild(tarjeta1);
                    });
                }).catch((err) => {
                    console.error('Error al realizar la consulta: ' + err);
                });
        }

        // Ejecutar las funciones
        viajesCurso(localStorage.getItem("session")); // Cambiar por nombre de usuario logeado
        viajesConcluidos(localStorage.getItem("session")); // Cambiar por nombre de usuario logeado

    </script>
</body>

</html>